@if (open()) {
  <div class="fixed inset-0 z-50 bg-slate-900/45" (click)="onBackdropClick($event)">
    <aside
      class="ml-auto flex h-full w-full max-w-md flex-col border-l border-slate-200 bg-white shadow-[-10px_0_30px_rgba(15,23,42,0.18)]"
      role="dialog"
      aria-modal="true"
      aria-label="Shopping cart"
    >
      <header class="flex items-center justify-between border-b border-slate-200 p-4">
        <h2 class="m-0 text-lg font-bold text-slate-900">Cart</h2>
        <button
          type="button"
          class="cursor-pointer border-0 bg-transparent text-[1.75rem] leading-none text-slate-600"
          (click)="onClose()"
          aria-label="Close cart"
        >
          Ã—
        </button>
      </header>

      <div class="overflow-auto p-4">
        @if (cartItems$ | async; as cartItems) {
          @if (cartItems.length === 0) {
            <p class="m-0 text-slate-500">Your cart is empty.</p>
          } @else {
            <ul class="m-0 flex list-none flex-col gap-3 p-0">
              @for (item of cartItems; track item.productId) {
                <li class="grid grid-cols-[4rem_1fr] items-start gap-3 rounded-xl border border-slate-200 p-3">
                  <img [src]="item.image" [alt]="item.title" class="h-16 w-16 object-contain" />

                  <div>
                    <p class="m-0 text-sm font-semibold text-slate-900">{{ item.title }}</p>
                    <p class="my-1 text-[0.8125rem] text-slate-600">
                      {{ item.quantity }} x {{ item.price | currency }} = {{ item.price * item.quantity | currency }}
                    </p>

                    <div class="flex flex-wrap items-center gap-1.5">
                      <input
                        type="number"
                        min="1"
                        [value]="getActionQuantity(item)"
                        (input)="onActionQuantityInput(item, $event)"
                        class="w-14 rounded-[0.35rem] border border-slate-300 px-1.5 py-1.5 text-sm text-slate-900"
                        aria-label="Quantity to update"
                      />
                      <button
                        type="button"
                        class="cursor-pointer rounded-[0.35rem] border border-slate-900 bg-slate-900 px-2.5 py-1.5 text-[0.8rem] font-bold text-white transition hover:bg-slate-700"
                        (click)="onAdd(item)"
                      >
                        Add
                      </button>
                      <button
                        type="button"
                        class="cursor-pointer rounded-[0.35rem] border border-slate-300 bg-white px-2.5 py-1.5 text-[0.8rem] font-bold text-slate-700 transition hover:bg-slate-50"
                        (click)="onRemove(item)"
                      >
                        Remove
                      </button>
                    </div>
                  </div>
                </li>
              }
            </ul>
          }
        }
      </div>

      <footer class="mt-auto border-t border-slate-200 p-4">
        <div class="flex items-center justify-between text-[0.925rem] text-slate-700">
          <span>Items</span>
          <strong class="text-slate-900">{{ (itemCount$ | async) ?? 0 }}</strong>
        </div>
        <div class="mt-2 flex items-center justify-between text-[0.925rem] text-slate-700">
          <span>Total</span>
          <strong class="text-slate-900">{{ ((subtotal$ | async) ?? 0) | currency }}</strong>
        </div>
      </footer>
    </aside>
  </div>
}
